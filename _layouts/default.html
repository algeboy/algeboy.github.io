<!DOCTYPE html>
<html lang="{{ site.lang | default: 'en' }}">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% if page.title %}{{ page.title }} | {% endif %}{{ site.title }}</title>
  <meta name="description" content="{{ page.description | default: site.description }}">
  
  <link rel="stylesheet" href="{{ '/assets/css/main.css' | relative_url }}">
  
  {% if site.favicon %}
  <link rel="icon" href="{{ site.favicon | relative_url }}">
  {% endif %}
  
  <!-- MathJax for math rendering -->
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$'], ['\\[', '\\]']]
      }
    };
  </script>
  
  {% if site.google_analytics %}
  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id={{ site.google_analytics }}"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', '{{ site.google_analytics }}');
  </script>
  {% endif %}
</head>
<body>
  <!-- Classroom Header -->
  <div class="classroom-header">
    <button class="hamburger-menu" icon="fa fa-bars" id="hamburger-btn" aria-label="Menu">
      <span></span>
      <span><i class="fa fa-bars"></i></span>
      <span></span>
    </button>
  </div>
  
  <!-- Slide-in Navigation Menu -->
  <nav class="slide-menu" id="slide-menu">
    <button class="close-menu" id="close-menu" aria-label="Close Menu">‚úï</button>
    <ul>
      <li><a href="{{ '/' | relative_url }}">üè† Home</a></li>
      <li><a href="{{ '/publications/' | relative_url }}">üìö Publications</a></li>
      <li><a href="https://youtube.com/@{{ site.social.youtube }}" target="_blank">üì∫ YouTube</a></li>
      <li><a href="{{ '/about/' | relative_url }}">üë§ About</a></li>
      <li><a href="{{ '/contact/' | relative_url }}">‚úâÔ∏è Contact</a></li>
    </ul>
  </nav>
  
  <!-- Menu Overlay -->
  <div class="menu-overlay" id="menu-overlay"></div>
  
  <!-- Filing Cabinet and TV Overlay (outside chalkboard) -->
  <div class="desktop-enhancements">
    <div class="filing-cabinet-container">
      <!-- TV on top -->
      <div class="tv-container" id="tv-container">
        <div class="tv-frame">
          <div class="tv-screen" id="tv-screen">
            <span class="tv-display">@algeboy</span>
          </div>
          <div class="tv-brand">YouTube</div>
        </div>
        <div class="tv-base" padding="0"></div>
      </div>
      
      <!-- Projector Screen Overlay -->
      <div class="projector-screen" id="projector-screen">
        <div class="projector-close" id="projector-close">&times;</div>
        <div class="projector-content">
          <div class="youtube-container" id="youtube-container">
            <iframe id="youtube-iframe" 
                    src="about:blank" 
                    frameborder="0" 
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                    allowfullscreen>
            </iframe>
          </div>
        </div>
        <div class="projector-bottom"></div>
      </div>
      
      <!-- Filing Cabinet -->
      <div class="filing-cabinet">
        <div class="cabinet-body">
          <!-- Top Drawer - Articles -->
          <div class="drawer" id="articles-drawer">
            <div class="drawer-face">
              <div class="drawer-handle"></div>
              <div class="drawer-label">
                <span class="drawer-icon">üìÅ</span>
                Articles
              </div>
            </div>
          </div>
          
          <!-- Software Drawer -->
          <div class="drawer" id="software-drawer">
            <div class="drawer-face">
              <div class="drawer-handle"></div>
              <div class="drawer-label">
                <span class="floppy-icon">üíæ</span>
                Software
              </div>
            </div>
          </div>
          
          <!-- Teaching Drawer -->
          <div class="drawer" id="teaching-drawer">
            <div class="drawer-face">
              <div class="drawer-handle"></div>
              <div class="drawer-label">
                <span class="drawer-icon">‚úèÔ∏è</span>
                Posts
              </div>
            </div>
          </div>
          
          <!-- Bottom Drawer - Professional -->
          <div class="drawer" id="professional-drawer">
            <div class="drawer-face">
              <div class="drawer-handle"></div>
              <div class="drawer-label">
                <span class="drawer-icon">üéì</span>
                Professional
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Chalkboard Frame -->
  <div class="chalkboard-frame"></div>
  
  <!-- Scrollable Content Inside Chalkboard -->
  <div class="chalkboard-content">
    <header>
      <div class="container">
        <nav class="desktop-nav">
          <ul>
            <li><a href="{{ '/' | relative_url }}">Home</a></li>
            <li><a href="{{ '/about/' | relative_url }}">About</a></li>
            <li><a href="{{ '/publications/' | relative_url }}">Publications</a></li>
            <li><a href="{{ '/contact/' | relative_url }}">Contact</a></li>
          </ul>
        </nav>
      </div>
    </header>

    <main>
      {{ content }}
    </main>
  </div>
  
  <script>
    // Header click to go home
    const classroomHeader = document.querySelector('.classroom-header');
    if (classroomHeader) {
        classroomHeader.addEventListener('click', function() {
            window.location.href = '{{ "/" | relative_url }}';
        });
        console.log('Header click handler attached');
    }
    
    // Hamburger Menu Toggle - Wait for DOM
    document.addEventListener('DOMContentLoaded', function() {
      const hamburgerBtn = document.getElementById('hamburger-btn');
      const slideMenu = document.getElementById('slide-menu');
      const closeMenuBtn = document.getElementById('close-menu');
      const menuOverlay = document.getElementById('menu-overlay');
      
      function openMenu(e) {
        e.stopPropagation(); // Prevent click from bubbling to classroom-header
        slideMenu.classList.add('active');
        menuOverlay.classList.add('active');
        document.body.style.overflow = 'hidden';
      }
      
      function closeMenu() {
        slideMenu.classList.remove('active');
        menuOverlay.classList.remove('active');
        document.body.style.overflow = '';
      }
      
      if (hamburgerBtn && slideMenu && closeMenuBtn && menuOverlay) {
        hamburgerBtn.addEventListener('click', openMenu);
        closeMenuBtn.addEventListener('click', closeMenu);
        menuOverlay.addEventListener('click', closeMenu);
        
        // Close menu when clicking on a link
        const menuLinks = slideMenu.querySelectorAll('a');
        menuLinks.forEach(link => {
          link.addEventListener('click', closeMenu);
        });
        console.log('Hamburger menu initialized');
      } else {
        console.error('Hamburger menu elements not found');
      }
    });
  </script>
</head>
<body>

  <script>
    console.log('Script tag loaded!');
    
    // Audio context for motor sound
    let audioContext = null;
    let motorOscillator = null;
    let motorGainNode = null;
    
    // Initialize audio context
    function initAudio() {
        if (!audioContext) {
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
        }
    }
    
    // Create motor sound effect
    function createMotorSound() {
        initAudio();
        
        // Create oscillator for motor sound
        motorOscillator = audioContext.createOscillator();
        motorGainNode = audioContext.createGain();
        
        // Set up humming sound characteristics
        motorOscillator.type = 'sine'; // Sine wave for smooth hum
        motorOscillator.frequency.setValueAtTime(80, audioContext.currentTime); // Higher frequency for hum
        
        // Add subtle frequency modulation for realistic hum effect
        const lfo = audioContext.createOscillator();
        const lfoGain = audioContext.createGain();
        
        lfo.frequency.setValueAtTime(3, audioContext.currentTime); // Slower 3Hz modulation
        lfoGain.gain.setValueAtTime(2, audioContext.currentTime); // Very slight frequency variation
        
        lfo.connect(lfoGain);
        lfoGain.connect(motorOscillator.frequency);
        
        // Set up gain envelope
        motorGainNode.gain.setValueAtTime(0, audioContext.currentTime);
        
        // Connect audio graph
        motorOscillator.connect(motorGainNode);
        motorGainNode.connect(audioContext.destination);
        
        // Start oscillators
        motorOscillator.start();
        lfo.start();
        
        return { oscillator: motorOscillator, gain: motorGainNode, lfo: lfo };
    }
    
    // Play motor sound during animation
    function playMotorSound(duration = 800) {
        try {
            const motor = createMotorSound();
            
            // Fade in
            motor.gain.gain.linearRampToValueAtTime(0.1, audioContext.currentTime + 0.1);
            
            // Fade out near end
            motor.gain.gain.linearRampToValueAtTime(0.1, audioContext.currentTime + (duration / 1000) - 0.2);
            motor.gain.gain.linearRampToValueAtTime(0, audioContext.currentTime + (duration / 1000));
            
            // Stop after duration
            setTimeout(() => {
                motor.oscillator.stop();
                motor.lfo.stop();
            }, duration);
            
        } catch (error) {
            console.log('Audio not available:', error);
        }
    }
    
    // Filing Cabinet and TV functionality
    document.addEventListener('DOMContentLoaded', function() {
        console.log('DOM Content Loaded event fired!');
        
        try {
            console.log('DOM loaded, initializing filing cabinet and projector...');
            
            // Get elements with debugging
            const articlesDrawer = document.getElementById('articles-drawer');
            const professionalDrawer = document.getElementById('professional-drawer');
            const tvContainer = document.getElementById('tv-container');
            const projectorScreen = document.getElementById('projector-screen');
            const projectorClose = document.getElementById('projector-close');
            const youtubeIframe = document.getElementById('youtube-iframe');

            console.log('Elements found:', {
                articlesDrawer: !!articlesDrawer,
                professionalDrawer: !!professionalDrawer,
                tvContainer: !!tvContainer,
                projectorScreen: !!projectorScreen,
                projectorClose: !!projectorClose,
                youtubeIframe: !!youtubeIframe
            });

            // TV Click Handler - Show Projector Screen
            if (tvContainer && projectorScreen) {
                tvContainer.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('TV clicked! Showing projector screen...');
                    
                    // Play motor sound while screen descends
                    playMotorSound(800);
                    
                    // Show projector screen with animation
                    projectorScreen.classList.add('active');
                    
                    // Load YouTube video after screen descends (800ms animation + 300ms pause)
                    if (youtubeIframe) {
                        setTimeout(() => {
                            youtubeIframe.src = 'https://www.youtube.com/embed/D8Upe7RGL94?autoplay=1';
                        }, 2100);
                    }
                });
                console.log('TV click handler attached');
            } else {
                console.error('TV container or projector screen not found!');
            }

            // Close Projector Handler
            if (projectorClose && projectorScreen) {
                projectorClose.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('Closing projector screen...');
                    
                    // Play motor sound while screen retracts
                    playMotorSound(800);
                    
                    // Hide projector screen
                    projectorScreen.classList.remove('active');
                    
                    // Stop YouTube video
                    if (youtubeIframe) {
                        setTimeout(() => {
                            youtubeIframe.src = 'about:blank';
                        }, 800); // Wait for animation to complete
                    }
                });
                console.log('Projector close handler attached');
            }

            // Articles drawer handler
            if (articlesDrawer) {
                articlesDrawer.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('Articles drawer clicked!');
                    window.location.href = '/publications/';
                });
                console.log('Articles drawer event listener attached');
            } else {
                console.error('Articles drawer not found!');
            }

            // Software drawer handler
            const softwareDrawer = document.getElementById('software-drawer');
            if (softwareDrawer) {
                softwareDrawer.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('Software drawer clicked!');
                    window.location.href = '/softwareTools/';
                });
                console.log('Software drawer event listener attached');
            } else {
                console.error('Software drawer not found!');
            }

            // Posts drawer handler (formerly Teaching)
            const postsDrawer = document.getElementById('teaching-drawer');
            if (postsDrawer) {
                postsDrawer.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('Posts drawer clicked!');
                    window.location.href = '/posts/';
                });
                console.log('Posts drawer event listener attached');
            } else {
                console.error('Posts drawer not found!');
            }

            // Professional drawer handler
            if (professionalDrawer) {
                professionalDrawer.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('Professional drawer clicked!');
                    window.location.href = '/about/';
                });
                console.log('Professional drawer event listener attached');
            } else {
                console.error('Professional drawer not found!');
            }

            console.log('Filing cabinet and projector initialization complete');
            
        } catch (error) {
            console.error('Error in filing cabinet initialization:', error);
            console.error('Error stack:', error.stack);
        }
    });
    
    console.log('End of script tag reached');
  </script>
</body>
</html>
